{% extends "base.html" %}
{% load static %}

{% block content %}
    <div class="container mt-4">
        <div class="card shadow-lg border-0 rounded-lg">
            <div class="card-body d-flex flex-column flex-md-row align-items-center">
                <!-- Аватар -->
                <div class="me-4 text-center">
                    {% if card.avatar %}
                        <img src="{{ card.avatar.url }}" alt="Аватар" class="rounded-circle border"
                             style="width: 120px; height: 120px; object-fit: cover;">
                    {% else %}
                        <img src="{% static 'images/default-avatar.png' %}" alt="Аватар"
                             class="rounded-circle border"
                             style="width: 120px; height: 120px; object-fit: cover;">
                    {% endif %}
                </div>

                <!-- Инфо -->
                <div class="flex-grow-1">
                    <h3 class="mb-1">{{ author.username }}</h3>
                    <p class="text-muted mb-2">{{ card.bio|default:"Автор пока не написал о себе." }}</p>

                    <div class="row text-center mb-3">
                        <div class="col">
                            <h6 class="mb-0">{{ posts_count }}</h6>
                            <small class="text-muted">Постов</small>
                        </div>
                        <div class="col">
                            <h6 class="mb-0">{{ replies_count }}</h6>
                            <small class="text-muted">Откликов</small>
                        </div>
                        <div class="col">
                            <h6 class="mb-0">{{ accepted_replies }}</h6>
                            <small class="text-muted">Принято</small>
                        </div>
                        <div class="col">
                            <h6 class="mb-0">{{ card.reputation }}</h6>
                            <small class="text-muted">Репутация</small>
                        </div>
                    </div>

                    <!-- Кнопка подписки -->
                    <!-- Кнопка подписки -->
                    {% if user != author %}
                        <a href="#" class="btn btn-primary btn-sm">Подписаться</a>
                    {% endif %}

                    {% if user == author %}
                        <a href="{% url 'profile' %}" class="btn btn-outline-secondary btn-sm">Мой профиль</a>
                    {% endif %}
                </div>
            </div>

            <!-- Последний пост -->
            {% if last_post %}
                <div class="card-footer bg-light">
                    <h6 class="mb-1">Последний пост:</h6>
                    <p class="mb-0">
                        <a href="{% url 'post_detail' last_post.id %}">
                            {{ last_post.title }}
                        </a>
                        <small class="text-muted"> ({{ last_post.created_at|date:"d.m.Y" }})</small>
                    </p>
                </div>
            {% endif %}

            <!-- Популярные категории -->
            {% if top_categories %}
                <div class="card-footer bg-white">
                    <h6 class="mb-2">Активен в категориях:</h6>
                    {% for cat in top_categories %}
                        <span class="badge bg-info text-dark me-1">
                        {{ cat.category__title }} ({{ cat.cnt }})
                    </span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}
